import{_ as t}from"./chunks/ArticleMetadata.f3b87b78.js";import{_ as r,c,E as y,B as A,z as l,a as i,R as D,G as C,o as p,A as B,C as F}from"./chunks/framework.23582046.js";import"./chunks/md5.3856627a.js";const L=JSON.parse('{"title":"用Java8获取近N天日期","description":"","frontmatter":{"title":"用Java8获取近N天日期","author":"查尔斯","date":"2021/11/18 20:55","categories":["方案春秋志"],"tags":["Java"]},"headers":[],"relativePath":"categories/solutions/2021/11/18/用Java8获取近N天日期.md","filePath":"categories/solutions/2021/11/18/用Java8获取近N天日期.md","lastUpdated":1660404656000}'),u={name:"categories/solutions/2021/11/18/用Java8获取近N天日期.md"},E=l("h1",{id:"用java8获取近n天日期",tabindex:"-1"},[i("用Java8获取近N天日期 "),l("a",{class:"header-anchor",href:"#用java8获取近n天日期","aria-label":'Permalink to "用Java8获取近N天日期"'},"​")],-1),d=D(`<h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p><strong>C：</strong> 登录进入管理类系统，首页一般都是以展示数据仪表盘为主。例如：展示一些总量、展示近一周或是近 N 天的某数据的折线图、柱状图等等。</p><p>那在展示这类近 N 天的图表时，后端必然要给前端提供一个近 N 天的日期集合用于显示。</p><p>至于实现的方法也有很多种，笔者在这儿就记录一种目前看来扩展性相对较好的方案。</p><h2 id="涉及技术栈" tabindex="-1">涉及技术栈 <a class="header-anchor" href="#涉及技术栈" aria-label="Permalink to &quot;涉及技术栈&quot;">​</a></h2><ul><li>Spring Boot 2.3.1.RELEASE</li><li>MyBatis Plus 3.1.0（使用了 MyBatis Plus 的代码生成器）</li></ul><h2 id="controller层" tabindex="-1">Controller层 <a class="header-anchor" href="#controller层" aria-label="Permalink to &quot;Controller层&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">/**</span></span>
<span class="line"><span style="color:#768390;"> * 统计控制器</span></span>
<span class="line"><span style="color:#768390;"> *</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@author</span><span style="color:#768390;"> Charles7c</span></span>
<span class="line"><span style="color:#768390;"> * @date 2021/11/18 20:55</span></span>
<span class="line"><span style="color:#768390;"> */</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Api</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;统计接口&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">tags</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;统计接口集&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">RestController</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">RequestMapping</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/statistics&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">StatisticsController</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">Resource</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">private</span><span style="color:#ADBAC7;"> IRequestService</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">requestService;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">GetMapping</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/request/{days}&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">ApiOperation</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;日请求数据统计&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">notes</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;日请求数据统计接口&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> R&lt;Map&lt;</span><span style="color:#F47067;">String</span><span style="color:#ADBAC7;">, </span><span style="color:#F47067;">Object</span><span style="color:#ADBAC7;">&gt;&gt; </span><span style="color:#DCBDFB;">requestByDays</span><span style="color:#ADBAC7;">(@</span><span style="color:#F47067;">ApiParam</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;days&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">required</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">) @</span><span style="color:#F47067;">PathVariable</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;days&quot;</span><span style="color:#ADBAC7;">) Integer </span><span style="color:#F69D50;">days</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> R.</span><span style="color:#DCBDFB;">ok</span><span style="color:#ADBAC7;">(requestService.</span><span style="color:#DCBDFB;">getRequestTotal</span><span style="color:#ADBAC7;">(day));</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 统计控制器</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@author</span><span style="color:#6A737D;"> Charles7c</span></span>
<span class="line"><span style="color:#6A737D;"> * @date 2021/11/18 20:55</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Api</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;统计接口&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">tags</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;统计接口集&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RestController</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RequestMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/statistics&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">StatisticsController</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Resource</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> IRequestService requestService;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">GetMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/request/{days}&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ApiOperation</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;日请求数据统计&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">notes</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;日请求数据统计接口&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> R&lt;Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">Object</span><span style="color:#24292E;">&gt;&gt; </span><span style="color:#6F42C1;">requestByDays</span><span style="color:#24292E;">(@</span><span style="color:#D73A49;">ApiParam</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;days&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">required</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) @</span><span style="color:#D73A49;">PathVariable</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;days&quot;</span><span style="color:#24292E;">) Integer </span><span style="color:#E36209;">days</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> R.</span><span style="color:#6F42C1;">ok</span><span style="color:#24292E;">(requestService.</span><span style="color:#6F42C1;">getRequestTotal</span><span style="color:#24292E;">(day));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h2 id="service层" tabindex="-1">Service层 <a class="header-anchor" href="#service层" aria-label="Permalink to &quot;Service层&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">笔者说</p><p>Service 层接口内容略，这个应该对你没影响吧？</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#768390;">/**</span></span>
<span class="line"><span style="color:#768390;"> * 请求服务实现类</span></span>
<span class="line"><span style="color:#768390;"> *</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@author</span><span style="color:#768390;"> Charles7c</span></span>
<span class="line"><span style="color:#768390;"> * @date 2021/11/18 20:55</span></span>
<span class="line"><span style="color:#768390;"> */</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Service</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">class</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">RequestServiceImpl</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">extends</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">ServiceImpl</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F47067;">RequestMapper</span><span style="color:#ADBAC7;">, </span><span style="color:#F47067;">Request</span><span style="color:#ADBAC7;">&gt; </span><span style="color:#F47067;">implements</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">IRequestService</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    @</span><span style="color:#F47067;">Override</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> Map&lt;</span><span style="color:#F47067;">String</span><span style="color:#ADBAC7;">, </span><span style="color:#F47067;">Object</span><span style="color:#ADBAC7;">&gt; </span><span style="color:#DCBDFB;">getRequestTotal</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">days</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 响应数据</span></span>
<span class="line"><span style="color:#ADBAC7;">        Map</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">String</span><span style="color:#F69D50;">, </span><span style="color:#F47067;">Object</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">respMap</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> MapUtil.</span><span style="color:#DCBDFB;">newHashMap</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 日期列表</span></span>
<span class="line"><span style="color:#ADBAC7;">    	List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">String</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">dateList</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> ArrayList&lt;&gt;(days);</span></span>
<span class="line"><span style="color:#ADBAC7;">		</span><span style="color:#768390;">// 请求列表</span></span>
<span class="line"><span style="color:#ADBAC7;">        List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">String</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">requestList</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// ...</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 指定日期格式</span></span>
<span class="line"><span style="color:#ADBAC7;">    	DateTimeFormatter</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">formatter</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> DateTimeFormatter.</span><span style="color:#DCBDFB;">ofPattern</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;yyyy-MM-dd&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 遍历生成日期列表</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 例如：days 为 5，现在是 2021-11-18,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 则可以获取到 2021-11-14、2021-11-15、2021-11-16、2021-11-17、2021-11-18</span></span>
<span class="line"><span style="color:#ADBAC7;">    	</span><span style="color:#F47067;">for</span><span style="color:#ADBAC7;"> (</span><span style="color:#F47067;">int</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">i</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> days </span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">; i </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">; i</span><span style="color:#F47067;">--</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#768390;">// 当前日期 - i天</span></span>
<span class="line highlighted"><span style="color:#ADBAC7;">    		LocalDateTime</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">plusDate</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> LocalDateTime.</span><span style="color:#DCBDFB;">now</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">plusDays</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;">i);</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#768390;">// 将日期转换为 yyyy-MM-dd 格式字符串</span></span>
<span class="line highlighted"><span style="color:#ADBAC7;">        	String</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">plusDateStr</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> formatter.</span><span style="color:#DCBDFB;">format</span><span style="color:#ADBAC7;">(plusDate);</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#768390;">// 添加到日期列表</span></span>
<span class="line"><span style="color:#ADBAC7;">        	dateList.</span><span style="color:#DCBDFB;">add</span><span style="color:#ADBAC7;">(plusDateStr);</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#768390;">// [根据日期查询指定统计数据列表（具体使用时，根据你自己需求决定查询什么表，什么字段...，此处仅为样例）]</span></span>
<span class="line highlighted"><span style="color:#ADBAC7;">			LambdaQueryWrapper</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">Request</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">queryWrapper</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> Wrappers.</span><span style="color:#DCBDFB;">lambdaQuery</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#768390;">// 拼接 SQL，apply 用法，参见：https://mp.baomidou.com/guide/wrapper.html#apply</span></span>
<span class="line highlighted"><span style="color:#ADBAC7;">			queryWrapper.</span><span style="color:#DCBDFB;">apply</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;date_format(create_time, &#39;%Y-%m-%d&#39;) = {0}&quot;</span><span style="color:#ADBAC7;">, plusDateStr);</span></span>
<span class="line"><span style="color:#ADBAC7;">			requestList.</span><span style="color:#DCBDFB;">add</span><span style="color:#ADBAC7;">(baseMapper.</span><span style="color:#DCBDFB;">selectCount</span><span style="color:#ADBAC7;">(queryWrapper).</span><span style="color:#DCBDFB;">toString</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#768390;">// ...</span></span>
<span class="line"><span style="color:#ADBAC7;">    	}</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 添加响应数据</span></span>
<span class="line"><span style="color:#ADBAC7;">        respMap.</span><span style="color:#DCBDFB;">put</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;dateList&quot;</span><span style="color:#ADBAC7;">, dateList);</span></span>
<span class="line"><span style="color:#ADBAC7;">        respMap.</span><span style="color:#DCBDFB;">put</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;requestList&quot;</span><span style="color:#ADBAC7;">, requestList);</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// ...</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> respMap;</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 请求服务实现类</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@author</span><span style="color:#6A737D;"> Charles7c</span></span>
<span class="line"><span style="color:#6A737D;"> * @date 2021/11/18 20:55</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Service</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RequestServiceImpl</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServiceImpl</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">RequestMapper</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">Request</span><span style="color:#24292E;">&gt; </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IRequestService</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">Object</span><span style="color:#24292E;">&gt; </span><span style="color:#6F42C1;">getRequestTotal</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">days</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 响应数据</span></span>
<span class="line"><span style="color:#24292E;">        Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">Object</span><span style="color:#24292E;">&gt; respMap </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> MapUtil.</span><span style="color:#6F42C1;">newHashMap</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 日期列表</span></span>
<span class="line"><span style="color:#24292E;">    	List&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; dateList </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ArrayList&lt;&gt;(days);</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6A737D;">// 请求列表</span></span>
<span class="line"><span style="color:#24292E;">        List&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; requestList </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 指定日期格式</span></span>
<span class="line"><span style="color:#24292E;">    	DateTimeFormatter formatter </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> DateTimeFormatter.</span><span style="color:#6F42C1;">ofPattern</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;yyyy-MM-dd&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 遍历生成日期列表</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 例如：days 为 5，现在是 2021-11-18,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 则可以获取到 2021-11-14、2021-11-15、2021-11-16、2021-11-17、2021-11-18</span></span>
<span class="line"><span style="color:#24292E;">    	</span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> days </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">--</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 当前日期 - i天</span></span>
<span class="line highlighted"><span style="color:#24292E;">    		LocalDateTime plusDate </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> LocalDateTime.</span><span style="color:#6F42C1;">now</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">plusDays</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">i);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 将日期转换为 yyyy-MM-dd 格式字符串</span></span>
<span class="line highlighted"><span style="color:#24292E;">        	String plusDateStr </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> formatter.</span><span style="color:#6F42C1;">format</span><span style="color:#24292E;">(plusDate);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 添加到日期列表</span></span>
<span class="line"><span style="color:#24292E;">        	dateList.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(plusDateStr);</span></span>
<span class="line"><span style="color:#24292E;">            </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// [根据日期查询指定统计数据列表（具体使用时，根据你自己需求决定查询什么表，什么字段...，此处仅为样例）]</span></span>
<span class="line highlighted"><span style="color:#24292E;">			LambdaQueryWrapper&lt;</span><span style="color:#D73A49;">Request</span><span style="color:#24292E;">&gt; queryWrapper </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Wrappers.</span><span style="color:#6F42C1;">lambdaQuery</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 拼接 SQL，apply 用法，参见：https://mp.baomidou.com/guide/wrapper.html#apply</span></span>
<span class="line highlighted"><span style="color:#24292E;">			queryWrapper.</span><span style="color:#6F42C1;">apply</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;date_format(create_time, &#39;%Y-%m-%d&#39;) = {0}&quot;</span><span style="color:#24292E;">, plusDateStr);</span></span>
<span class="line"><span style="color:#24292E;">			requestList.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(baseMapper.</span><span style="color:#6F42C1;">selectCount</span><span style="color:#24292E;">(queryWrapper).</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">            </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">    	}</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 添加响应数据</span></span>
<span class="line"><span style="color:#24292E;">        respMap.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;dateList&quot;</span><span style="color:#24292E;">, dateList);</span></span>
<span class="line"><span style="color:#24292E;">        respMap.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;requestList&quot;</span><span style="color:#24292E;">, requestList);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> respMap;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div>`,11);function q(s,h,g,m,v,S){const o=t,e=C("ClientOnly");return p(),c("div",null,[E,y(e,null,{default:A(()=>{var a,n;return[(((a=s.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=s.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(p(),B(o,{key:0,article:s.$frontmatter},null,8,["article"])):F("",!0)]}),_:1}),d])}const f=r(u,[["render",q]]);export{L as __pageData,f as default};
