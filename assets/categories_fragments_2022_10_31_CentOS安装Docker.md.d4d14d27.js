import{_ as c}from"./chunks/ArticleMetadata.2a1f8ae6.js";import{_ as t,c as r,g as i,w as d,b as n,f as y,a as k,i as u,o as l,e as h,v as m}from"./app.439d55bc.js";const C="/assets/202210312020985.a11a25ba.png",x=JSON.parse('{"title":"CentOS 安装 Docker、Docker Compose","description":"","frontmatter":{"title":"CentOS 安装 Docker、Docker Compose","author":"查尔斯","date":"2022/10/31 20:56","categories":["杂碎逆袭史"],"tags":["Docker","Linux","CentOS"]},"headers":[{"level":2,"title":"Docker 安装","slug":"docker-安装","link":"#docker-安装","children":[{"level":3,"title":"方式一","slug":"方式一","link":"#方式一","children":[]},{"level":3,"title":"方式二（推荐）","slug":"方式二-推荐","link":"#方式二-推荐","children":[]}]},{"level":2,"title":"Docker 配置","slug":"docker-配置","link":"#docker-配置","children":[]},{"level":2,"title":"Docker Compose 安装","slug":"docker-compose-安装","link":"#docker-compose-安装","children":[]},{"level":2,"title":"参考资料","slug":"参考资料","link":"#参考资料","children":[]}],"relativePath":"categories/fragments/2022/10/31/CentOS安装Docker.md","lastUpdated":1669526061000}'),D={name:"categories/fragments/2022/10/31/CentOS安装Docker.md"},A=n("h1",{id:"centos-安装-docker、docker-compose",tabindex:"-1"},[y("CentOS 安装 Docker、Docker Compose "),n("a",{class:"header-anchor",href:"#centos-安装-docker、docker-compose","aria-hidden":"true"},"#")],-1),B=k(`<div class="tip custom-block"><p class="custom-block-title">笔者说</p><p>笔者下面的步骤及配置是基于发帖时间当下的实践，大多数程序大多数情况下在相差不大的版本时可以直接参考。</p></div><h2 id="docker-安装" tabindex="-1">Docker 安装 <a class="header-anchor" href="#docker-安装" aria-hidden="true">#</a></h2><h3 id="方式一" tabindex="-1">方式一 <a class="header-anchor" href="#方式一" aria-hidden="true">#</a></h3><ol><li><p>软件更新</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">yum -y update</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">yum -y update</span></span>
<span class="line"></span></code></pre></div></li><li><p>安装 yum-utils</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">yum -y install yum-utils device-mapper-persistent-data lvm2</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">yum -y install yum-utils device-mapper-persistent-data lvm2</span></span>
<span class="line"></span></code></pre></div></li><li><p>设置 yum 软件源</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"></span></code></pre></div></li><li><p>安装 docker-ce（免费社区版）</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">yum -y install docker-ce</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">yum -y install docker-ce</span></span>
<span class="line"></span></code></pre></div></li><li><p>启动 docker</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">systemctl start docker</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">systemctl start docker</span></span>
<span class="line"></span></code></pre></div></li><li><p>设置 docker 开机自启</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">systemctl </span><span style="color:#56B6C2;">enable</span><span style="color:#ABB2BF;"> docker</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">systemctl </span><span style="color:#82AAFF;">enable</span><span style="color:#A6ACCD;"> docker</span></span>
<span class="line"></span></code></pre></div></li><li><p>检验是否安装成功</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">docker -v</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">docker -v</span></span>
<span class="line"></span></code></pre></div></li></ol><h3 id="方式二-推荐" tabindex="-1">方式二（推荐） <a class="header-anchor" href="#方式二-推荐" aria-hidden="true">#</a></h3><p>一条命令安装 docker。</p><ol><li>下载并安装 docker</li><li>启动并设置 docker 开机自启</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun &amp;&amp; systemctl start docker &amp;&amp; systemctl </span><span style="color:#56B6C2;">enable</span><span style="color:#ABB2BF;"> docker</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">curl -fsSL https://get.docker.com </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> bash -s docker --mirror Aliyun </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> systemctl start docker </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> systemctl </span><span style="color:#82AAFF;">enable</span><span style="color:#A6ACCD;"> docker</span></span>
<span class="line"></span></code></pre></div><h2 id="docker-配置" tabindex="-1">Docker 配置 <a class="header-anchor" href="#docker-配置" aria-hidden="true">#</a></h2><p>在 Windows 系统中安装软件时，我们都清楚要尽量不安装在 C 盘，数据存储也尽量迁移到其他空间更大的盘。不然随着程序的使用，数据越来越多，再加上大多数情况下 C 盘空间并不大，最终导致 C 盘很快会被占满。</p><p>同理，不更改 docker 的数据存储目录，那它的镜像、容器等存储占用随着使用时间的增长而增长，那你的服务器系统盘很快就会被占满了。所以建议你将 docker 的数据存储目录改到你服务器的数据盘挂载目录。</p><p>更改 docker 数据存储目录这一点是笔者推荐的，而设置 docker 镜像加速这一点其实根本无需笔者多言，你先不配置，用用 docker 再说，如果你 <code>docker pull</code> 速度很快，那完全不需要配置。这三个镜像加速源是笔者验证过的，当你感受到拉镜像的 “绝望” 时，不妨再来配置试一试。</p><div class="tip custom-block"><p class="custom-block-title">笔者说</p><p>关于镜像加速地址，你还可以从阿里云找到你专属的镜像加速地址。</p><p>按下面的路径就可以找到：</p><p>产品与服务 -&gt; 容器与中间件 -&gt; 容器服务 -&gt; 容器镜像服务 -&gt; 镜像加速器</p></div><p><img src="`+C+`" alt="202210312020985"></p><p>闲话不多说，配置只需要 3~5 步即可搞定。</p><ol><li><p>编辑 daemon.json 配置文件</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#7F848E;"># 如果 /etc 下没有 docker 目录，可以先创建一下</span></span>
<span class="line"><span style="color:#7F848E;"># mkdir -p /etc/docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">vim /etc/docker/daemon.json</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#676E95;"># 如果 /etc 下没有 docker 目录，可以先创建一下</span></span>
<span class="line"><span style="color:#676E95;"># mkdir -p /etc/docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">vim /etc/docker/daemon.json</span></span>
<span class="line"></span></code></pre></div></li><li><p>将下方配置内容写入 daemon.json 配置文件</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">&quot;data-root&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;/opt/disk/docker&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">&quot;registry-mirrors&quot;</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&quot;https://hub-mirror.c.163.com&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&quot;https://mirror.baidubce.com&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&quot;https://ustc-edu-cn.mirror.aliyuncs.com&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">data-root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/opt/disk/docker</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">registry-mirrors</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://hub-mirror.c.163.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://mirror.baidubce.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://ustc-edu-cn.mirror.aliyuncs.com</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>重新加载服务配置文件并重启 docker 服务</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#7F848E;"># 重新加载服务配置文件</span></span>
<span class="line"><span style="color:#ABB2BF;">systemctl daemon-reload</span></span>
<span class="line"><span style="color:#7F848E;"># 重启 docker</span></span>
<span class="line"><span style="color:#ABB2BF;">systemctl restart docker</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#676E95;"># 重新加载服务配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl daemon-reload</span></span>
<span class="line"><span style="color:#676E95;"># 重启 docker</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl restart docker</span></span>
<span class="line"></span></code></pre></div></li></ol><h2 id="docker-compose-安装" tabindex="-1">Docker Compose 安装 <a class="header-anchor" href="#docker-compose-安装" aria-hidden="true">#</a></h2><ol><li><p>下载 docker-compose 脚本，并改名为 docker-compose</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">curl -L https://github.com/docker/compose/releases/download/v2.12.2/docker-compose-</span><span style="color:#98C379;">$(uname -s)</span><span style="color:#ABB2BF;">-</span><span style="color:#98C379;">$(uname -m)</span><span style="color:#ABB2BF;"> -o /usr/local/bin/docker-compose</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">curl -L https://github.com/docker/compose/releases/download/v2.12.2/docker-compose-</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">uname -s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">-</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">uname -m</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> -o /usr/local/bin/docker-compose</span></span>
<span class="line"></span></code></pre></div></li><li><p>给脚本授予可执行权限</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">chmod +x /usr/local/bin/docker-compose</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">chmod +x /usr/local/bin/docker-compose</span></span>
<span class="line"></span></code></pre></div></li><li><p>检验是否安装成功</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#ABB2BF;">docker-compose -v</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A6ACCD;">docker-compose -v</span></span>
<span class="line"></span></code></pre></div></li></ol><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-hidden="true">#</a></h2><ol><li>Custom Docker daemon options#Runtime directory and storage driver：<a href="https://docs.docker.com/config/daemon/systemd/#runtime-directory-and-storage-driver" target="_blank" rel="noreferrer">https://docs.docker.com/config/daemon/systemd/#runtime-directory-and-storage-driver</a></li></ol>`,20);function F(s,g,v,b,_,f){const o=c,p=u("ClientOnly");return l(),r("div",null,[A,i(p,null,{default:d(()=>{var a,e;return[(((a=s.$frontmatter)==null?void 0:a.aside)??!0)&&(((e=s.$frontmatter)==null?void 0:e.showArticleMetadata)??!0)?(l(),h(o,{key:0,article:s.$frontmatter},null,8,["article"])):m("",!0)]}),_:1}),B])}const S=t(D,[["render",F]]);export{x as __pageData,S as default};
